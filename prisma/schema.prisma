generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model MBSCD {
  mbscd       String @id @unique @db.VarChar(2)
  mbscdDetail String @db.VarChar(100)
  bscdItems  BSCD[]
}

model BSCD {
  bscd       String  @unique @db.VarChar(2)
  mbscd      String  @db.VarChar(2)
  bscdDetail String  @db.VarChar(100)
  mainBscd   MBSCD   @relation(fields: [mbscd], references: [mbscd])
  macnoItems MACNO[]

  @@id([mbscd, bscd])
}

model MACNO {
  macno    String @unique @db.VarChar(3)
  bscd     String @db.VarChar(2)
  macname  String @db.VarChar(100)
  bscdRef  BSCD   @relation(fields: [bscd], references: [bscd])
  accounts ACNO[]

  @@id([bscd, macno])
}

model ACNO {
  acno               String               @unique @db.VarChar(4)
  macno              String               @db.VarChar(3)
  acname             String               @db.VarChar(250)
  bankAccountNo      String?              @map("bank_account_no") @db.VarChar(25)
  address            String?              @db.VarChar(150)
  city               String?              @db.VarChar(50)
  phoneFax           String?              @map("phone_fax") @db.VarChar(50)
  email              String?              @db.VarChar(25)
  website            String?              @db.VarChar(25)
  crDays             Int?                 @map("cr_days")
  stRate             Decimal?             @map("st_rate") @db.Decimal(15, 2)
  area               String?              @db.VarChar(50)
  category           String?              @map("catagory") @db.VarChar(50)
  subCategory        String?              @map("sub_catagory") @db.VarChar(25)
  country            String?              @db.VarChar(25)
  customerBank       String?              @map("customer_bank") @db.VarChar(50)
  customerBankAddr   String?              @map("customer_bank_addr") @db.VarChar(100)
  stRegNo            String?              @map("st_reg_no") @db.VarChar(25)
  ntnNo              String?              @map("ntn_no") @db.VarChar(25)
  contactPerson      String?              @map("contact_person") @db.VarChar(25)
  crLimit            Int?                 @map("cr_limit")
  salesArea          String?              @map("sales_ares") @db.VarChar(25)
  transactionsMaster TransactionsMaster[]
  transactions       Transactions[]
  mainAccount        MACNO                @relation(fields: [macno], references: [macno])

  @@id([macno, acno])
  @@map("acno")
}

model Company {
  id                 Int                  @id @default(autoincrement())
  company            String?              @db.VarChar(100)
  addr1              String?              @db.VarChar(100)
  addr2              String?              @db.VarChar(100)
  city               String?              @db.VarChar(50)
  phone              String?              @db.VarChar(50)
  fax                String?              @db.VarChar(50)
  email              String?              @db.VarChar(50)
  costCenters        CostCenter[]
  departments        Department[]
  designations       Designation[]
  godowns            Godown[]
  TransactionsMaster TransactionsMaster[]
  users              Users[]
  financialYears    FinancialYear[]
  seasons            Season[]
  poPrdCats         PoPrdCat[]
  deliveryModes      DeliveryMode[]
  deliveryTerms      DeliveryTerm[]
  commissionTerms    CommissionTerm[]
  employees          Employee[]
}

model CostCenter {
  ccno        Int            @id @default(autoincrement())
  company_id  Int
  ccname      String?        @db.VarChar(50)
  company     Company        @relation(fields: [company_id], references: [id])
  Transaction Transactions[]
}

model Department {
  id         Int     @id @default(autoincrement())
  dept_name  String? @db.VarChar(100)
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model ProductMasterCategory {
  id         Int     @id @default(autoincrement())
  pmc_name  String? @db.VarChar(250)
  productGroups         ProductGroup[]


}

model ProductGroup {
  id         Int     @id @default(autoincrement())
  pg_name  String? @db.VarChar(250)
  pmc_id    Int
  productCategories     ProductCategory[] 
  ProductMasterCategories       ProductMasterCategory @relation(fields: [pmc_id], references: [id])
}

model ProductCategory {
  id         Int     @id @default(autoincrement())
  pc_name  String? @db.VarChar(250)
  pg_id      Int
  mainCategories        MainCategory[]
  ProductGroups         ProductGroup @relation(fields: [pg_id], references: [id])
}

model MainCategory {
  id         Int     @id @default(autoincrement())
  mc_name  String? @db.VarChar(100)
  pc_id    Int
  itemCategories        ItemCategory[]
  ProductCategories       ProductCategory @relation(fields: [pc_id], references: [id])
}

model ItemCategory {
  id            Int           @id @default(autoincrement())
  ic_name       String        @db.VarChar(250)
  mc_id         Int
  wc_category_id Int?         @unique
  stock_acno     Int?        @default(4) // New field for stock account number
  sale_acno      Int?        
  cogs_acno      Int?        
  sync_status   String?       @default("synced") @db.VarChar(20)
  last_sync     DateTime?     @default(now())
  mainCategory  MainCategory  @relation(fields: [mc_id], references: [id])
  items         Item[]
}

model Item {
  itcd         Int        @id @unique @default(autoincrement())
  item    String?        @db.VarChar(250)
  ic_id        Int
  sku           String?    @unique
  price         Float?
  stock         Int?
  description   String?    @db.VarChar(500)
  wc_product_id Int?       @unique
  image_url    String?    @db.VarChar(500)  // New field for product image
  wc_parent_id  Int?
  sync_status   String?    @default("synced")
  last_sync     DateTime?
  itemCategories ItemCategory   @relation(fields: [ic_id], references: [id])
  Transactions Transactions[]
}


model Designation {
  id         Int     @id @default(autoincrement())
  desg_name  String? @db.VarChar(100)
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model Godown {
  id                 Int                  @id @default(autoincrement())
  godown             String               @db.VarChar(100)
  company_id         Int
  company            Company              @relation(fields: [company_id], references: [id])
  TransactionsMaster TransactionsMaster[]
  Transaction        Transactions[]
}

model FinancialYear {
  id        Int      @id @default(autoincrement())
  date_from DateTime
  date_to   DateTime
  status    String   @db.Char(50)
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model Season {
  id        Int      @id @default(autoincrement())
  date_from DateTime
  date_to   DateTime
  status    String   @db.Char(50)
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model PoPrdCat {
  id            Int    @id @default(autoincrement())
  category_name String @db.Char(50)
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model DeliveryMode {
  id            Int    @id @default(autoincrement())
  delivery_mode String @db.Char(50)
  rate_kg       Int
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model Users {
  user_id            String               @id @unique @db.VarChar(10)
  user_name          String?              @db.VarChar(50)
  company_id         Int
  transactionsMaster TransactionsMaster[]
  company            Company              @relation(fields: [company_id], references: [id])
}

model Currency {
  id           Int            @id @unique @default(autoincrement())
  currency     String         @unique @db.VarChar(50)
  transactions Transactions[]
}

model TransactionsMaster {
  tran_id       Int           @id @default(autoincrement())
  company_id    Int?
  dateD         DateTime?
  time          DateTime?
  tran_code     Int?
  vr_no         Int?           
  pycd          String?
  check_no      String?       @map("CHECK_NO")
  check_date    DateTime?     @map("CHECK_DATE")
  rmk           String?       @map("RMK")
  rmk1          String?       @map("RMK1")
  rmk2          String?       @map("RMK2")
  rmk3          String?       @map("RMK3")
  rmk4          String?       @map("RMK4")
  rmk5          String?       @map("RMK5")
  userId        String?        @map("USER_ID")
  invoice_no    String?       @db.Char(150)
  godown        Int?
  user          Users?         @relation(fields: [userId], references: [user_id])
  company       Company?       @relation(fields: [company_id], references: [id])
  godownDetails Godown?       @relation(fields: [godown], references: [id])
  acno          ACNO?          @relation(fields: [pycd], references: [acno])
  transactions  Transactions[]
  wc_order_id   Int?          @unique
  sync_status   String?       @default("synced") @db.VarChar(20)
  last_sync     DateTime?     @default(now())

  @@unique([tran_code, vr_no]) // Enforces no duplicate voucher numbers per tran_code
  @@map("TRANSACTIONS_MASTER")
}



model Transactions {
  id                 Int                @id @default(autoincrement())
  tran_id            Int               
  acno               String?
  itcd               Int?
  ccno               Int?
  narration1         String?            @db.Char(150)
  narration2         String?            @db.Char(150)
  narration3         String?            @db.Char(150)
  narration4         String?            @db.Char(150)
  narration5         String?            @db.Char(150)
  chno               String?            @db.Char(150)
  check_date         DateTime?
  party_name         String?            @db.Char(150)
  damt               Float?
  camt               Float?
  qty                Float?
  rate               Float?
  wht_rate           Float?
  st_rate            Float?
  godown             Int?
  invoice_no         String?            @db.Char(150)
  sub_tran_id        Int?                @default(1)
  currency           Int?  
  gross_amount       Float?           
  fc_amount          Float?
  no_of_pack         Float?
  qty_per_pack       Float?
  st_amount          Float?
  additional_tax     Float?
  acnoDetails        ACNO?               @relation(fields: [acno], references: [acno])
  costCenter         CostCenter?         @relation(fields: [ccno], references: [ccno])
  currencyDetails    Currency?           @relation(fields: [currency], references: [id])
  godownDetails      Godown?             @relation(fields: [godown], references: [id])
  itemDetails        Item?               @relation(fields: [itcd], references: [itcd])
  transactionsMaster TransactionsMaster @relation(fields: [tran_id], references: [tran_id])
}

model DeliveryTerm {
  id            Int    @id @default(autoincrement())
  delivery_term String @db.Char(50)
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model CommissionTerm {
  id            Int    @id @default(autoincrement())
  commission_term String @db.Char(50)
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model Employee {
  id               String     @id @default(uuid()) @map("id")
  first_name       String     @map("first_name")
  middle_name      String?    @map("middle_name")
  surname          String     @map("surname")
  dob              DateTime   @map("dob")
  gender           Gender?    @map("gender")
  phone_number     String     @map("phone_number")
  npf_number       String     @map("npf_number")
  email_address    String     @map("email_address")
  village          String     @map("village")
  status           Status?    @map("status")
  hire_date        DateTime   @map("hire_date")
  job_title        String     @map("job_title")
  department       String     @map("department")
  work_location    String     @map("work_location")
  manager_id       String?    @map("manager_id")
  manager          Manager?   @relation(fields: [manager_id], references: [id])
  client_id        String     @map("client_id")
  employer         Employer   @relation(fields: [client_id], references: [employer_id])
  employee_id      String     @unique @map("employee_id")
  payment_method   PaymentMethod? @map("payment_method")
  bank_name        String?    @map("bank_name")
  account_name     String?    @map("account_name")
  account_number   String?    @map("account_number")
  pay_type         PayType?   @map("pay_type")
  rate_per_hour    Float      @map("rate_per_hour")
  pay_frequency    PayFrequency? @map("pay_frequency")
  employee_type    String     @map("employee_type")
  cost_center      String     @map("cost_center")
  allownces        Json       @map("allownces")
  allownce_eligible Boolean    @default(false) @map("allownce_eligible")
  deductions       Json       @map("deductions")
  leaves           Leave[]
  profile_image    String?    @map("profile_image")
  documents        Document[]
  created_on       DateTime   @default(now()) @map("created_on")
  updated_on       DateTime   @updatedAt @map("updated_on")
  company_id Int
  company    Company @relation(fields: [company_id], references: [id])
}

model Leave {
  id         String   @id @default(uuid())
  leave_id   String   @map("leave_id")
  available  Float    @map("available")
  employee   Employee @relation(fields: [employee_id], references: [id])
  employee_id String   @map("employee_id")
}

model Document {
  id          String   @id @default(uuid())
  url         String   @map("url")
  name        String   @map("name")
  description String?  @map("description")
  employee    Employee @relation(fields: [employee_id], references: [id])
  employee_id String   @map("employee_id")
}

model Manager {
  id        String     @id @default(uuid())
  employees Employee[]
}

model Employer {
  employer_id String     @id @map("employer_id")
  employees   Employee[]
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Status {
  ACTIVE
  INACTIVE
}

enum PaymentMethod {
  CASH
  DIRECT_DEPOSIT
  CHEQUE
}

enum PayType {
  HOUR
  SALARY
}

enum PayFrequency {
  Monthly
  Fortnightly
  Weekly
}
